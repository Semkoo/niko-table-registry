{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "data-table-column-sort",
  "title": "DataTable Column Sort",
  "description": "Column header sort options with ascending/descending/clear controls.",
  "dependencies": [
    "lucide-react"
  ],
  "registryDependencies": [
    "https://niko-table.com/r/data-table.json",
    "button",
    "dropdown-menu",
    "tooltip"
  ],
  "files": [
    {
      "path": "src/components/niko-table/components/data-table-column-sort.tsx",
      "content": "\"use client\"\n\nimport React from \"react\"\n\nimport {\n  TableColumnSortOptions,\n  TableColumnSortMenu,\n} from \"../filters/table-column-sort\"\nimport { useDataTable } from \"../core\"\nimport { useColumnHeaderContext } from \"./data-table-column-header\"\n\n/**\n * Sorting options for column header menu using context.\n */\nexport function DataTableColumnSortOptions<TData, TValue>(\n  props: Omit<\n    React.ComponentProps<typeof TableColumnSortOptions>,\n    \"column\" | \"table\"\n  >,\n) {\n  const { column } = useColumnHeaderContext<TData, TValue>(true)\n  const { table } = useDataTable<TData>()\n  return <TableColumnSortOptions column={column} table={table} {...props} />\n}\n\nDataTableColumnSortOptions.displayName = \"DataTableColumnSortOptions\"\n\n/**\n * Sorting menu for column header using context.\n *\n * Standalone button variant for inline use outside dropdown menus.\n */\nexport function DataTableColumnSortMenu<TData, TValue>(\n  props: Omit<\n    React.ComponentProps<typeof TableColumnSortMenu>,\n    \"column\" | \"table\"\n  >,\n) {\n  const { column } = useColumnHeaderContext<TData, TValue>(true)\n  const { table } = useDataTable<TData>()\n  return <TableColumnSortMenu column={column} table={table} {...props} />\n}\n\nDataTableColumnSortMenu.displayName = \"DataTableColumnSortMenu\"\n",
      "type": "registry:component",
      "target": "components/niko-table/components/data-table-column-sort.tsx"
    },
    {
      "path": "src/components/niko-table/filters/table-column-sort.tsx",
      "content": "\"use client\"\n\nimport React from \"react\"\nimport type { Column, Table } from \"@tanstack/react-table\"\nimport { Check, CircleHelp } from \"lucide-react\"\n\nimport { Button } from \"@/components/ui/button\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\nimport { cn } from \"@/lib/utils\"\nimport { useDataTable } from \"../core/data-table-context\"\n\nimport { SORT_ICONS, SORT_LABELS } from \"../config/data-table\"\nimport type { SortIconVariant } from \"../config/data-table\"\nimport { FILTER_VARIANTS } from \"../lib/constants\"\n\n/**\n * Sort options menu items for composition inside TableColumnActions.\n *\n * @example\n * ```tsx\n * <TableColumnActions>\n *   <TableColumnSortOptions column={column} />\n * </TableColumnActions>\n * ```\n */\nexport function TableColumnSortOptions<TData, TValue>({\n  column,\n  table: propTable,\n  variant: propVariant,\n  withSeparator = true,\n}: {\n  column: Column<TData, TValue>\n  table?: Table<TData>\n  variant?: SortIconVariant\n  /** Whether to render a separator before the options. @default true */\n  withSeparator?: boolean\n}) {\n  const context = useDataTable<TData>()\n  const table = propTable || context.table\n  const sortState = column.getIsSorted()\n\n  const variant =\n    propVariant || column.columnDef.meta?.variant || FILTER_VARIANTS.TEXT\n\n  const icons = SORT_ICONS[variant] || SORT_ICONS[FILTER_VARIANTS.TEXT]\n  const labels = SORT_LABELS[variant] || SORT_LABELS[FILTER_VARIANTS.TEXT]\n\n  const sortIndex = column.getSortIndex()\n  const isMultiSort = table && table.getState().sorting.length > 1\n  const showSortBadge = isMultiSort && sortIndex !== -1\n\n  /**\n   * Use a ref for immediate synchronous access to shift key state.\n   * React state updates are batched and async, which can cause race conditions\n   * when the dropdown closes - the keyup event might reset state before\n   * handleSort reads it. A ref provides synchronous access.\n   */\n  const isShiftPressedRef = React.useRef(false)\n  const [isShiftPressed, setIsShiftPressed] = React.useState(false)\n\n  React.useEffect(() => {\n    const handleKey = (e: KeyboardEvent) => {\n      if (e.key === \"Shift\") {\n        const isDown = e.type === \"keydown\"\n        isShiftPressedRef.current = isDown\n        setIsShiftPressed(isDown)\n      }\n    }\n    window.addEventListener(\"keydown\", handleKey, { capture: true })\n    window.addEventListener(\"keyup\", handleKey, { capture: true })\n    return () => {\n      window.removeEventListener(\"keydown\", handleKey, { capture: true })\n      window.removeEventListener(\"keyup\", handleKey, { capture: true })\n    }\n  }, [])\n\n  const handleSort = (\n    direction: \"asc\" | \"desc\" | false,\n    e:\n      | React.MouseEvent\n      | React.KeyboardEvent\n      | Event\n      | {\n          detail?: { originalEvent?: { shiftKey?: boolean } }\n          shiftKey?: boolean\n          nativeEvent?: { shiftKey?: boolean }\n        },\n  ) => {\n    // Detect multi-sort (Shift key)\n    // We check multiple sources in order of reliability:\n    // 1. Ref from global listener (most reliable - synchronous access, no batching issues)\n    // 2. State from global listener (backup, may have timing issues)\n    // 3. Direct event property (for native mouse/keyboard events)\n    // 4. Radix CustomEvent detail (specifically for DropdownMenuItem selection)\n    const isMulti =\n      isShiftPressedRef.current ||\n      isShiftPressed ||\n      (\"shiftKey\" in e && !!e.shiftKey) ||\n      (e as { detail?: { originalEvent?: { shiftKey?: boolean } } }).detail\n        ?.originalEvent?.shiftKey ||\n      (e as { nativeEvent?: { shiftKey?: boolean } }).nativeEvent?.shiftKey\n\n    if (direction === false) {\n      column.clearSorting()\n    } else {\n      const isDesc = direction === \"desc\"\n      const canMultiSort = column.getCanMultiSort()\n\n      /**\n       * @see https://tanstack.com/table/v8/docs/guide/sorting#multi-sorting\n       * When using toggleSorting explicitly, we must manually pass the multi-sort flag.\n       */\n      column.toggleSorting(isDesc, canMultiSort ? isMulti : false)\n    }\n  }\n\n  return (\n    <>\n      {withSeparator && <DropdownMenuSeparator />}\n      <DropdownMenuLabel className=\"flex items-center justify-between text-xs font-normal text-muted-foreground\">\n        <div className=\"flex items-center gap-2\">\n          <span>Column Sort</span>\n          {showSortBadge && (\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <span className=\"flex size-4 cursor-help items-center justify-center rounded-full bg-primary text-[10px] font-medium text-primary-foreground\">\n                  {sortIndex + 1}\n                </span>\n              </TooltipTrigger>\n              <TooltipContent side=\"right\">\n                Sort priority (order in which columns are sorted)\n              </TooltipContent>\n            </Tooltip>\n          )}\n        </div>\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <CircleHelp className=\"size-3.5 cursor-help\" />\n          </TooltipTrigger>\n          <TooltipContent side=\"right\">\n            TIP: Hold &apos;shift&apos; key to enable multi sort\n          </TooltipContent>\n        </Tooltip>\n      </DropdownMenuLabel>\n      <DropdownMenuItem\n        onSelect={e => handleSort(\"asc\", e)}\n        className={cn(\n          \"flex items-center\",\n          sortState === \"asc\" && \"bg-accent text-accent-foreground\",\n        )}\n      >\n        <icons.asc className=\"mr-2 size-4 text-muted-foreground/70\" />\n        <span className=\"flex-1\">{labels.asc}</span>\n        {sortState === \"asc\" && <Check className=\"ml-2 size-4\" />}\n      </DropdownMenuItem>\n      <DropdownMenuItem\n        onSelect={e => handleSort(\"desc\", e)}\n        className={cn(\n          \"flex items-center\",\n          sortState === \"desc\" && \"bg-accent text-accent-foreground\",\n        )}\n      >\n        <icons.desc className=\"mr-2 size-4 text-muted-foreground/70\" />\n        <span className=\"flex-1\">{labels.desc}</span>\n        {sortState === \"desc\" && <Check className=\"ml-2 size-4\" />}\n      </DropdownMenuItem>\n      {sortState && (\n        <DropdownMenuItem onSelect={() => column.clearSorting()}>\n          <icons.unsorted className=\"mr-2 size-4 text-muted-foreground/70\" />\n          Clear Sort\n        </DropdownMenuItem>\n      )}\n    </>\n  )\n}\n\n/**\n * Standalone dropdown menu for sorting.\n *\n * For composition inside TableColumnActions, use TableColumnSortOptions instead.\n *\n * @example\n * ```tsx\n * // Standalone\n * <TableColumnSortMenu column={column} table={table} />\n *\n * // Composed\n * <TableColumnActions>\n *   <TableColumnSortOptions column={column} />\n * </TableColumnActions>\n * ```\n */\nexport function TableColumnSortMenu<TData, TValue>({\n  column,\n  table: propTable,\n  variant: propVariant,\n  className,\n}: {\n  column: Column<TData, TValue>\n  table?: Table<TData>\n  variant?: SortIconVariant\n  className?: string\n}) {\n  const context = useDataTable<TData>()\n  const table = propTable || context.table\n  const canSort = column.getCanSort()\n  const sortState = column.getIsSorted()\n\n  const variant =\n    propVariant || column.columnDef.meta?.variant || FILTER_VARIANTS.TEXT\n\n  const icons = SORT_ICONS[variant] || SORT_ICONS[FILTER_VARIANTS.TEXT]\n\n  if (!canSort) return null\n\n  const SortIcon =\n    sortState === \"asc\"\n      ? icons.asc\n      : sortState === \"desc\"\n        ? icons.desc\n        : icons.unsorted\n\n  const sortIndex = column.getSortIndex()\n  const isMultiSort = table && table.getState().sorting.length > 1\n  const showSortBadge = isMultiSort && sortIndex !== -1\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          className={cn(\n            \"size-7 transition-opacity dark:text-muted-foreground\",\n            sortState && \"text-primary\",\n            className,\n          )}\n        >\n          <div className=\"relative flex items-center justify-center\">\n            <SortIcon className=\"size-4\" />\n            {showSortBadge && (\n              <span className=\"absolute -top-1 -right-2 flex size-3 items-center justify-center rounded-full bg-primary text-[9px] text-primary-foreground\">\n                {sortIndex + 1}\n              </span>\n            )}\n          </div>\n          <span className=\"sr-only\">Sort column</span>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" className=\"w-48\">\n        <TableColumnSortOptions\n          column={column}\n          table={table}\n          variant={variant}\n          withSeparator={false}\n        />\n      </DropdownMenuContent>\n    </DropdownMenu>\n  )\n}\n\nTableColumnSortOptions.displayName = \"TableColumnSortOptions\"\nTableColumnSortMenu.displayName = \"TableColumnSortMenu\"\n",
      "type": "registry:component",
      "target": "components/niko-table/filters/table-column-sort.tsx"
    }
  ],
  "type": "registry:component"
}