{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "data-table-column-date-filter",
  "title": "DataTable Column Date Filter",
  "description": "Column header date filter with calendar picker in a dropdown.",
  "dependencies": [
    "lucide-react",
    "react-day-picker"
  ],
  "registryDependencies": [
    "https://niko-table.com/r/data-table.json",
    "button",
    "dropdown-menu",
    "tooltip",
    "popover",
    "calendar"
  ],
  "files": [
    {
      "path": "src/components/niko-table/components/data-table-column-date-filter-options.tsx",
      "content": "\"use client\"\n\nimport React from \"react\"\nimport type { Column } from \"@tanstack/react-table\"\n\nimport {\n  TableColumnDateFilterOptions,\n  TableColumnDateFilterMenu,\n} from \"../filters/table-column-date-filter\"\nimport { useColumnHeaderContext } from \"./data-table-column-header\"\n\n/**\n * Date filter options for composing inside DataTableColumnActions using context.\n */\nexport function DataTableColumnDateFilterOptions<TData, TValue>(\n  props: Omit<\n    React.ComponentProps<typeof TableColumnDateFilterOptions>,\n    \"column\"\n  > & {\n    column?: Column<TData, TValue>\n  },\n) {\n  const context = useColumnHeaderContext<TData, TValue>(false)\n  const column = props.column || context?.column\n\n  if (!column) {\n    console.warn(\n      \"DataTableColumnDateFilterOptions must be used within DataTableColumnHeaderRoot or provided with a column prop\",\n    )\n    return null\n  }\n\n  return <TableColumnDateFilterOptions column={column} {...props} />\n}\n\nDataTableColumnDateFilterOptions.displayName =\n  \"DataTableColumnDateFilterOptions\"\n\n/**\n * Standalone date filter menu for column header using context.\n */\nexport function DataTableColumnDateFilterMenu<TData, TValue>(\n  props: Omit<\n    React.ComponentProps<typeof TableColumnDateFilterMenu>,\n    \"column\"\n  > & {\n    column?: Column<TData, TValue>\n  },\n) {\n  const context = useColumnHeaderContext<TData, TValue>(false)\n  const column = props.column || context?.column\n\n  if (!column) {\n    console.warn(\n      \"DataTableColumnDateFilterMenu must be used within DataTableColumnHeaderRoot or provided with a column prop\",\n    )\n    return null\n  }\n\n  return <TableColumnDateFilterMenu column={column} {...props} />\n}\n\nDataTableColumnDateFilterMenu.displayName = \"DataTableColumnDateFilterMenu\"\n",
      "type": "registry:component",
      "target": "components/niko-table/components/data-table-column-date-filter-options.tsx"
    },
    {
      "path": "src/components/niko-table/filters/table-column-date-filter.tsx",
      "content": "\"use client\"\n\nimport React from \"react\"\nimport type { Column } from \"@tanstack/react-table\"\nimport type { DateRange } from \"react-day-picker\"\nimport { CircleHelp, CalendarIcon, CalendarX2 } from \"lucide-react\"\n\nimport {\n  DropdownMenuSeparator,\n  DropdownMenuLabel,\n} from \"@/components/ui/dropdown-menu\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\nimport { Calendar } from \"@/components/ui/calendar\"\nimport { Button } from \"@/components/ui/button\"\nimport { useDerivedColumnTitle } from \"../hooks\"\nimport { formatDate } from \"../lib/format\"\nimport { cn } from \"@/lib/utils\"\n\ntype DateSelection = Date[] | DateRange\n\nfunction parseAsDate(timestamp: number | string | undefined): Date | undefined {\n  if (!timestamp) return undefined\n  const numericTimestamp =\n    typeof timestamp === \"string\" ? Number(timestamp) : timestamp\n  const date = new Date(numericTimestamp)\n  return !Number.isNaN(date.getTime()) ? date : undefined\n}\n\nfunction parseColumnFilterValue(value: unknown) {\n  if (value === null || value === undefined) {\n    return []\n  }\n\n  if (Array.isArray(value)) {\n    return value.map(item => {\n      if (typeof item === \"number\" || typeof item === \"string\") {\n        return item\n      }\n      return undefined\n    })\n  }\n\n  if (typeof value === \"string\" || typeof value === \"number\") {\n    return [value]\n  }\n\n  return []\n}\n\n/**\n * Date filter options for composing inside TableColumnActions.\n * Renders as button that opens a popover with calendar picker - matches FilterDatePicker from table-filter-menu.\n *\n * @example\n * ```tsx\n * // Inside TableColumnActions\n * <TableColumnActions column={column}>\n *   <TableColumnDateFilterOptions\n *     column={column}\n *     multiple\n *   />\n * </TableColumnActions>\n * ```\n */\nexport function TableColumnDateFilterOptions<TData, TValue>({\n  column,\n  title,\n  multiple = true,\n  withSeparator = true,\n}: {\n  column: Column<TData, TValue>\n  title?: string\n  /** Whether to allow date range selection. Defaults to true. */\n  multiple?: boolean\n  /** Whether to render a separator before the options. Defaults to true. */\n  withSeparator?: boolean\n}) {\n  const [showValueSelector, setShowValueSelector] = React.useState(false)\n  const columnFilterValue = column.getFilterValue()\n\n  const selectedDates = React.useMemo<DateSelection>(() => {\n    if (!columnFilterValue) {\n      return multiple ? { from: undefined, to: undefined } : []\n    }\n\n    if (multiple) {\n      const timestamps = parseColumnFilterValue(columnFilterValue)\n      return {\n        from: parseAsDate(timestamps[0]),\n        to: parseAsDate(timestamps[1]),\n      }\n    }\n\n    const timestamps = parseColumnFilterValue(columnFilterValue)\n    const date = parseAsDate(timestamps[0])\n    return date ? [date] : []\n  }, [columnFilterValue, multiple])\n\n  const derivedTitle = useDerivedColumnTitle(column, column.id, title)\n  const labelText = multiple ? \"Date Range Filter\" : \"Date Filter\"\n  const tooltipText = multiple\n    ? \"Select a date range to filter\"\n    : \"Select a date to filter\"\n\n  const dateValue = Array.isArray(selectedDates)\n    ? selectedDates.filter(Boolean)\n    : [selectedDates.from, selectedDates.to].filter(Boolean)\n\n  const displayValue =\n    multiple && dateValue.length === 2\n      ? `${formatDate(dateValue[0] as Date)} - ${formatDate(dateValue[1] as Date)}`\n      : dateValue[0]\n        ? formatDate(dateValue[0] as Date)\n        : \"Pick a date\"\n\n  const onSelect = React.useCallback(\n    (date: Date | DateRange | undefined) => {\n      if (!date) {\n        column.setFilterValue(undefined)\n        return\n      }\n\n      if (multiple && !(\"getTime\" in date)) {\n        const from = date.from?.getTime()\n        const to = date.to?.getTime()\n\n        if (from && to) {\n          column.setFilterValue([from, to])\n        } else if (from) {\n          column.setFilterValue([from])\n        } else {\n          column.setFilterValue(undefined)\n        }\n      } else if (!multiple && \"getTime\" in date) {\n        column.setFilterValue([date.getTime()])\n      }\n    },\n    [column, multiple],\n  )\n\n  const onReset = React.useCallback(() => {\n    column.setFilterValue(undefined)\n  }, [column])\n\n  return (\n    <>\n      {withSeparator && <DropdownMenuSeparator />}\n      <DropdownMenuLabel className=\"flex items-center justify-between text-xs font-normal text-muted-foreground\">\n        <span>{labelText}</span>\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <CircleHelp className=\"size-3.5 cursor-help\" />\n          </TooltipTrigger>\n          <TooltipContent side=\"right\">\n            {tooltipText}\n            {derivedTitle && ` - ${derivedTitle}`}\n          </TooltipContent>\n        </Tooltip>\n      </DropdownMenuLabel>\n      <div className=\"px-2 py-2\">\n        <Popover open={showValueSelector} onOpenChange={setShowValueSelector}>\n          <PopoverTrigger asChild>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className={cn(\n                \"w-full justify-start rounded text-left font-normal\",\n                !columnFilterValue && \"text-muted-foreground\",\n              )}\n            >\n              <CalendarIcon />\n              <span className=\"truncate\">{displayValue}</span>\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent align=\"start\" className=\"w-auto p-0\">\n            {multiple ? (\n              <Calendar\n                mode=\"range\"\n                captionLayout=\"dropdown\"\n                selected={selectedDates as DateRange}\n                onSelect={onSelect as (date: DateRange | undefined) => void}\n              />\n            ) : (\n              <Calendar\n                mode=\"single\"\n                captionLayout=\"dropdown\"\n                selected={(selectedDates as Date[])[0]}\n                onSelect={onSelect as (date: Date | undefined) => void}\n              />\n            )}\n          </PopoverContent>\n        </Popover>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={onReset}\n          className=\"mt-2 w-full\"\n        >\n          Clear\n        </Button>\n      </div>\n    </>\n  )\n}\n\nTableColumnDateFilterOptions.displayName = \"TableColumnDateFilterOptions\"\n\n/**\n * Standalone date filter menu for column headers.\n * Shows a filter button that opens a popover with a calendar picker.\n *\n * @example\n * ```tsx\n * // Standalone usage\n * <TableColumnDateFilterMenu\n *   column={column}\n *   multiple\n * />\n * ```\n */\nexport function TableColumnDateFilterMenu<TData, TValue>({\n  column,\n  title,\n  className,\n  ...props\n}: Omit<\n  React.ComponentProps<typeof TableColumnDateFilterOptions>,\n  \"withSeparator\" | \"column\"\n> & {\n  column: Column<TData, TValue>\n  className?: string\n}) {\n  return (\n    <Popover>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          className={cn(\n            \"size-7 transition-opacity dark:text-muted-foreground\",\n            column.getIsFiltered() && \"text-primary\",\n            className,\n          )}\n        >\n          {column.getIsFiltered() ? (\n            <CalendarX2 className=\"size-3.5\" />\n          ) : (\n            <CalendarIcon className=\"size-3.5\" />\n          )}\n          <span className=\"sr-only\">Filter by date</span>\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent align=\"end\" className=\"w-auto p-0\">\n        <TableColumnDateFilterOptions\n          column={column}\n          title={title}\n          withSeparator={false}\n          {...props}\n        />\n      </PopoverContent>\n    </Popover>\n  )\n}\n\nTableColumnDateFilterMenu.displayName = \"TableColumnDateFilterMenu\"\n",
      "type": "registry:component",
      "target": "components/niko-table/filters/table-column-date-filter.tsx"
    }
  ],
  "type": "registry:component"
}