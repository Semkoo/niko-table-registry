{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "data-table-sort-menu",
  "title": "DataTable Sort Menu",
  "description": "Sort management menu with multi-column sorting and drag-and-drop reordering.",
  "dependencies": [
    "lucide-react",
    "@dnd-kit/core",
    "@dnd-kit/modifiers",
    "@dnd-kit/sortable",
    "@dnd-kit/utilities"
  ],
  "registryDependencies": [
    "https://niko-table.com/r/data-table.json",
    "button",
    "badge",
    "command",
    "popover",
    "tooltip",
    "select",
    "sortable"
  ],
  "files": [
    {
      "path": "src/components/niko-table/components/data-table-sort-menu.tsx",
      "content": "\"use client\"\n\nimport { useDataTable } from \"../core\"\nimport {\n  TableSortMenu,\n  type TableSortMenuProps,\n} from \"../filters/table-sort-menu\"\n\ntype DataTableSortMenuProps<TData> = Omit<TableSortMenuProps<TData>, \"table\">\n\n/**\n * A sort menu component that automatically connects to the DataTable context\n * and allows users to manage multiple sorting criteria.\n *\n * @example - Basic usage with default settings\n * <DataTableSortMenu />\n *\n * @example - Custom alignment and positioning\n * <DataTableSortMenu align=\"end\" side=\"bottom\" />\n *\n * @example - With debounce for performance\n * <DataTableSortMenu debounceMs={300} />\n *\n * @example - With throttle for frequent updates\n * <DataTableSortMenu throttleMs={100} />\n *\n * @example - Custom styling\n * <DataTableSortMenu className=\"w-[400px]\" />\n */\nexport function DataTableSortMenu<TData>(props: DataTableSortMenuProps<TData>) {\n  const { table } = useDataTable<TData>()\n  return <TableSortMenu<TData> table={table} {...props} />\n}\n\n/**\n * @required displayName is required for auto feature detection\n * @see \"feature-detection.ts\"\n */\n\nDataTableSortMenu.displayName = \"DataTableSortMenu\"\n",
      "type": "registry:component",
      "target": "components/niko-table/components/data-table-sort-menu.tsx"
    },
    {
      "path": "src/components/niko-table/filters/table-sort-menu.tsx",
      "content": "\"use client\"\n\n/**\n * Table sort menu component\n * @description A sort menu component for DataTable that allows users to manage multiple sorting criteria. Users can add, remove, and reorder sorting fields, as well as select sort directions.\n */\n\nimport type { ColumnSort, SortDirection, Table } from \"@tanstack/react-table\"\nimport { ArrowDownUp, Trash2, CircleHelp } from \"lucide-react\"\nimport * as React from \"react\"\n\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\"\nimport {\n  Sortable,\n  SortableContent,\n  SortableItem,\n  SortableItemHandle,\n  SortableOverlay,\n} from \"@/components/ui/sortable\"\nimport { useKeyboardShortcut } from \"../hooks\"\nimport { cn } from \"@/lib/utils\"\nimport { ChevronsUpDown, Grip } from \"lucide-react\"\n\n// Import sort labels from TableColumnHeader for consistency\nimport { SORT_LABELS } from \"../config/data-table\"\nimport { FILTER_VARIANTS } from \"../lib/constants\"\n\ninterface TableSortItemProps {\n  sort: ColumnSort\n  sortItemId: string\n  columns: { id: string; label: string }[]\n  columnLabels: Map<string, string>\n  onSortUpdate: (sortId: string, updates: Partial<ColumnSort>) => void\n  onSortRemove: (sortId: string) => void\n  className?: string\n}\n\nfunction TableSortItem({\n  sort,\n  sortItemId,\n  columns,\n  columnLabels,\n  onSortUpdate,\n  onSortRemove,\n}: TableSortItemProps) {\n  const fieldListboxId = `${sortItemId}-field-listbox`\n  const fieldTriggerId = `${sortItemId}-field-trigger`\n  const directionListboxId = `${sortItemId}-direction-listbox`\n\n  const [showFieldSelector, setShowFieldSelector] = React.useState(false)\n  const [showDirectionSelector, setShowDirectionSelector] =\n    React.useState(false)\n\n  const onItemKeyDown = React.useCallback(\n    (event: React.KeyboardEvent<HTMLLIElement>) => {\n      if (\n        event.target instanceof HTMLInputElement ||\n        event.target instanceof HTMLTextAreaElement\n      ) {\n        return\n      }\n\n      if (showFieldSelector || showDirectionSelector) {\n        return\n      }\n\n      if ([\"backspace\", \"delete\"].includes(event.key.toLowerCase())) {\n        event.preventDefault()\n        onSortRemove(sort.id)\n      }\n    },\n    [sort.id, showFieldSelector, showDirectionSelector, onSortRemove],\n  )\n\n  // Try to get the column's variant for sort label\n  // This assumes the table instance is available in closure (from parent TableSortMenu)\n  let variant = FILTER_VARIANTS.TEXT\n  try {\n    // @ts-expect-error: Accessing global window property for table instance variant detection\n    const col = (window.__tableSortMenuTable || null)\n      ?.getAllColumns?.()\n      .find?.((c: { id: string }) => c.id === sort.id)\n    variant = col?.columnDef?.meta?.variant || FILTER_VARIANTS.TEXT\n  } catch {\n    // ignore\n  }\n\n  const labels = SORT_LABELS[variant] || SORT_LABELS[FILTER_VARIANTS.TEXT]\n\n  return (\n    <SortableItem value={sort.id} asChild>\n      <li\n        id={sortItemId}\n        tabIndex={-1}\n        className=\"flex items-center gap-2\"\n        onKeyDown={onItemKeyDown}\n      >\n        <Popover open={showFieldSelector} onOpenChange={setShowFieldSelector}>\n          <PopoverTrigger asChild>\n            <Button\n              id={fieldTriggerId}\n              aria-controls={fieldListboxId}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"w-44 justify-between rounded font-normal\"\n            >\n              <span className=\"truncate\">{columnLabels.get(sort.id)}</span>\n              <ChevronsUpDown className=\"opacity-50\" />\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent\n            id={fieldListboxId}\n            className=\"w-(--radix-popover-trigger-width) origin-(--radix-popover-content-transform-origin) p-0\"\n          >\n            <Command>\n              <CommandInput placeholder=\"Search fields...\" />\n              <CommandList>\n                <CommandEmpty>No fields found.</CommandEmpty>\n                <CommandGroup>\n                  {columns.map(column => (\n                    <CommandItem\n                      key={column.id}\n                      value={column.id}\n                      onSelect={value => onSortUpdate(sort.id, { id: value })}\n                    >\n                      <span className=\"truncate\">{column.label}</span>\n                    </CommandItem>\n                  ))}\n                </CommandGroup>\n              </CommandList>\n            </Command>\n          </PopoverContent>\n        </Popover>\n        <Select\n          open={showDirectionSelector}\n          onOpenChange={setShowDirectionSelector}\n          value={sort.desc ? \"desc\" : \"asc\"}\n          onValueChange={(value: SortDirection) =>\n            onSortUpdate(sort.id, { desc: value === \"desc\" })\n          }\n        >\n          <SelectTrigger\n            aria-controls={directionListboxId}\n            className=\"h-8 w-24 rounded data-size:h-8\"\n          >\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent\n            id={directionListboxId}\n            className=\"min-w-(--radix-select-trigger-width) origin-(--radix-select-content-transform-origin)\"\n          >\n            <SelectItem value=\"asc\">{labels.asc}</SelectItem>\n            <SelectItem value=\"desc\">{labels.desc}</SelectItem>\n          </SelectContent>\n        </Select>\n        <Button\n          aria-controls={sortItemId}\n          variant=\"outline\"\n          size=\"icon\"\n          className=\"size-8 shrink-0 rounded\"\n          onClick={() => onSortRemove(sort.id)}\n        >\n          <Trash2 />\n        </Button>\n        <SortableItemHandle asChild>\n          <Button\n            variant=\"outline\"\n            size=\"icon\"\n            className=\"size-8 shrink-0 rounded\"\n          >\n            <Grip />\n          </Button>\n        </SortableItemHandle>\n      </li>\n    </SortableItem>\n  )\n}\n\nexport interface TableSortMenuProps<TData> extends React.ComponentProps<\n  typeof PopoverContent\n> {\n  table: Table<TData>\n  debounceMs?: number\n  throttleMs?: number\n  shallow?: boolean\n  className?: string\n  /**\n   * Callback fired when sorting state changes\n   * Useful for server-side sorting or external state management\n   */\n  onSortingChange?: (sorting: ColumnSort[]) => void\n}\n\nexport function TableSortMenu<TData>({\n  table,\n  onSortingChange: externalOnSortingChange,\n  className,\n  ...props\n}: TableSortMenuProps<TData>) {\n  // Expose table instance globally for TableSortItem variant detection\n  // (This is a workaround for passing table to deeply nested TableSortItem)\n  // @ts-expect-error: Assigning table instance to window for deep sort label access\n  // eslint-disable-next-line react-hooks/immutability\n  if (typeof window !== \"undefined\") window.__tableSortMenuTable = table\n  // ============================================================================\n  // State & Refs\n  // ============================================================================\n  const id = React.useId()\n  const labelId = React.useId()\n  const descriptionId = React.useId()\n  const [open, setOpen] = React.useState(false)\n  const addButtonRef = React.useRef<HTMLButtonElement>(null)\n\n  const sorting = table.getState().sorting\n\n  // ============================================================================\n  // Sorting State Management\n  // ============================================================================\n  const onSortingChange = React.useCallback(\n    (updater: React.SetStateAction<ColumnSort[]>) => {\n      table.setSorting(updater)\n      const newSorting =\n        typeof updater === \"function\" ? updater(sorting) : updater\n      externalOnSortingChange?.(newSorting)\n    },\n    [table, sorting, externalOnSortingChange],\n  )\n\n  // ============================================================================\n  // Column Labels & Available Columns\n  // ============================================================================\n  const { columnLabels, columns } = React.useMemo(() => {\n    const labels = new Map<string, string>()\n    const sortingIds = new Set(sorting.map(s => s.id))\n    const availableColumns: { id: string; label: string }[] = []\n\n    for (const column of table.getAllColumns()) {\n      if (!column.getCanSort()) continue\n\n      const label = column.columnDef.meta?.label ?? column.id\n      labels.set(column.id, label)\n\n      if (!sortingIds.has(column.id)) {\n        availableColumns.push({ id: column.id, label })\n      }\n    }\n\n    return {\n      columnLabels: labels,\n      columns: availableColumns,\n    }\n  }, [sorting, table])\n\n  // ============================================================================\n  // Sort Actions\n  // ============================================================================\n  const onSortAdd = React.useCallback(() => {\n    const firstColumn = columns[0]\n    if (!firstColumn) return\n\n    onSortingChange(prevSorting => [\n      ...prevSorting,\n      { id: firstColumn.id, desc: false },\n    ])\n  }, [columns, onSortingChange])\n\n  const onSortUpdate = React.useCallback(\n    (sortId: string, updates: Partial<ColumnSort>) => {\n      onSortingChange(prevSorting => {\n        if (!prevSorting) return prevSorting\n        return prevSorting.map(sort =>\n          sort.id === sortId ? { ...sort, ...updates } : sort,\n        )\n      })\n    },\n    [onSortingChange],\n  )\n\n  const onSortRemove = React.useCallback(\n    (sortId: string) => {\n      onSortingChange(prevSorting =>\n        prevSorting.filter(item => item.id !== sortId),\n      )\n    },\n    [onSortingChange],\n  )\n\n  const onSortingReset = React.useCallback(\n    () => onSortingChange(table.initialState.sorting),\n    [onSortingChange, table.initialState.sorting],\n  )\n\n  // ============================================================================\n  // Keyboard Shortcuts\n  // ============================================================================\n  // Toggle sort menu with 'S' key\n  useKeyboardShortcut({\n    key: \"s\",\n    onTrigger: () => setOpen(prev => !prev),\n  })\n\n  // Reset sorting with Shift+S\n  useKeyboardShortcut({\n    key: \"s\",\n    requireShift: true,\n    onTrigger: () => onSortingReset(),\n    condition: () => sorting.length > 0,\n  })\n\n  // Trigger button keyboard shortcuts (Backspace/Delete to reset)\n  const onTriggerKeyDown = React.useCallback(\n    (event: React.KeyboardEvent<HTMLButtonElement>) => {\n      if (\n        [\"backspace\", \"delete\"].includes(event.key.toLowerCase()) &&\n        sorting.length > 0\n      ) {\n        event.preventDefault()\n        onSortingReset()\n      }\n    },\n    [sorting.length, onSortingReset],\n  )\n\n  // ============================================================================\n  // Render\n  // ============================================================================\n\n  return (\n    <Sortable\n      value={sorting}\n      onValueChange={onSortingChange}\n      getItemValue={item => item.id}\n    >\n      <Popover open={open} onOpenChange={setOpen}>\n        <PopoverTrigger asChild>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onKeyDown={onTriggerKeyDown}\n            className={className}\n          >\n            <ArrowDownUp />\n            Sort\n            {sorting.length > 0 && (\n              <Badge\n                variant=\"secondary\"\n                className=\"h-[18.24px] rounded-[3.2px] px-[5.12px] font-mono text-[10.4px] font-normal\"\n              >\n                {sorting.length}\n              </Badge>\n            )}\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent\n          aria-labelledby={labelId}\n          aria-describedby={descriptionId}\n          className=\"flex w-full max-w-(--radix-popover-content-available-width) origin-(--radix-popover-content-transform-origin) flex-col gap-3.5 p-4 sm:min-w-[380px]\"\n          {...props}\n        >\n          <div className=\"flex flex-col gap-1\">\n            <div className=\"flex items-center gap-2\">\n              <h4 id={labelId} className=\"leading-none font-medium\">\n                {sorting.length > 0 ? \"Sort by\" : \"No sorting applied\"}\n              </h4>\n              {sorting.length > 1 && (\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <CircleHelp className=\"size-3.5 cursor-help text-muted-foreground\" />\n                  </TooltipTrigger>\n                  <TooltipContent side=\"right\">\n                    The order of fields determines sort priority\n                  </TooltipContent>\n                </Tooltip>\n              )}\n            </div>\n            <p\n              id={descriptionId}\n              className={cn(\n                \"text-sm text-muted-foreground\",\n                sorting.length > 0 && \"sr-only\",\n              )}\n            >\n              {sorting.length > 0\n                ? \"Modify sorting to organize your rows.\"\n                : \"Add sorting to organize your rows.\"}\n            </p>\n          </div>\n          {sorting.length > 0 && (\n            <SortableContent asChild>\n              <ul className=\"flex max-h-[300px] flex-col gap-2 overflow-y-auto p-1\">\n                {sorting.map(sort => (\n                  <TableSortItem\n                    key={sort.id}\n                    sort={sort}\n                    sortItemId={`${id}-sort-${sort.id}`}\n                    columns={columns}\n                    columnLabels={columnLabels}\n                    onSortUpdate={onSortUpdate}\n                    onSortRemove={onSortRemove}\n                  />\n                ))}\n              </ul>\n            </SortableContent>\n          )}\n          <div className=\"flex w-full items-center gap-2\">\n            <Button\n              size=\"sm\"\n              className=\"rounded\"\n              ref={addButtonRef}\n              onClick={onSortAdd}\n              disabled={columns.length === 0}\n            >\n              Add sort\n            </Button>\n            {sorting.length > 0 && (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"rounded\"\n                onClick={onSortingReset}\n              >\n                Reset sorting\n              </Button>\n            )}\n          </div>\n        </PopoverContent>\n      </Popover>\n      <SortableOverlay>\n        <div className=\"flex items-center gap-2\">\n          <div className=\"h-8 w-[180px] rounded-sm bg-primary/10\" />\n          <div className=\"h-8 w-24 rounded-sm bg-primary/10\" />\n          <div className=\"size-8 shrink-0 rounded-sm bg-primary/10\" />\n          <div className=\"size-8 shrink-0 rounded-sm bg-primary/10\" />\n        </div>\n      </SortableOverlay>\n    </Sortable>\n  )\n}\n\n/**\n * @required displayName is required for auto feature detection\n * @see \"feature-detection.ts\"\n */\nTableSortMenu.displayName = \"TableSortMenu\"\n",
      "type": "registry:component",
      "target": "components/niko-table/filters/table-sort-menu.tsx"
    }
  ],
  "type": "registry:component"
}